generator client { provider = "prisma-client-js" }
datasource db { provider = "sqlite"; url = "file:./dev.db" }

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String   // hashed
  createdAt DateTime @default(now())
  attempts  Attempt[]
}

model Quiz {
  id        String   @id @default(cuid())
  title     String
  csvUrl    String   @unique
  createdAt DateTime @default(now())
  attempts  Attempt[]
}

model Attempt {
  id        String    @id @default(cuid())
  user      User      @relation(fields: [userId], references: [id])
  userId    String
  quiz      Quiz      @relation(fields: [quizId], references: [id])
  quizId    String
  startedAt DateTime  @default(now())
  completedAt DateTime?
  score     Int       @default(0)
  total     Int       @default(0)
  accuracy  Float     @default(0)
  answers   Answer[]
}

model Answer {
  id           String   @id @default(cuid())
  attempt      Attempt  @relation(fields: [attemptId], references: [id])
  attemptId    String
  // A "question" is defined by a hash so we can aggregate across runs even if loaded from sheets at runtime.
  questionHash String
  questionText String
  section      String?
  selectedIdx  Int?
  correctIdx   Int
  isCorrect    Boolean
}
